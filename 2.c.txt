#include "igt.h"
#include "igt_collection.h"
#include "i915/gem_create.h"

int fd=drm_open_driver(DRIVER_INTEL);

struct drm_i915_gem_object2 bb={

.handle=gem_create(fd,4096);
};

uint32_t batch[4001];

for(int i=0;i<4000;i++)
{
	batch[i]=MI_NOOP;

}

batch[1001]=MI_BATCH_BUFFER_END;

gem_write(fd,bb.handle,0,batch,sizeof(batch));

struct drm_i915_gem_execbuffer2 execbuf2=
{

	.buffers_ptr=to_user_pointer(&bb);
	.buffer_count=1;
	
	}
	
gem_execbuf(fd,&execbuf2);

gem_sync(fd,bb.handle);

gem_execbuf(fd,&execbuf2);

gem_close(fd,bb.handle);

close(fd);